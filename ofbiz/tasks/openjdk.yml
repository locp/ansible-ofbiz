---
- name: Add an apt key by id from a keyserver
  apt_key:
    id: 86F44E2A
    keyserver: keyserver.ubuntu.com

- name: Configure Apt Repository
  apt_repository:
    repo: deb http://ppa.launchpad.net/openjdk-r/ppa/ubuntu trusty main

- name: OpenJDK package
  package:
    name: "{{ ofbiz_openjdk_package }}"

- name: Find closest Apache mirror
  uri:
    return_content: yes
    url: https://www.apache.org/dyn/closer.cgi?as_json=1
  register: ofbiz_apache_mirror_data
  when: ofbiz_download_path == ofbiz_apache_download_path

- name: Change download path to closest mirror
  set_fact:
    ofbiz_download_path: "{{ ofbiz_apache_mirror_data.json.preferred }}ofbiz"
  when: ofbiz_download_path == ofbiz_apache_download_path

- name: Download and extract the OFBiz software
  unarchive:
    creates: "{{ ofbiz_user_home_directory }}/apache-ofbiz-{{ ofbiz_version }}/LICENSE"
    dest: "{{ ofbiz_user_home_directory }}"
    group: "{{ ofbiz_group }}"
    owner: "{{ ofbiz_user }}"
    remote_src: yes
    src: "{{ ofbiz_download_path }}/apache-ofbiz-{{ ofbiz_version }}.zip"
